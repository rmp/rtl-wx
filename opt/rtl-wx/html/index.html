<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <style>
     .row { border: 1px solid red; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row h-25">
	<div class="col-lg-6 col-md-6 col-sm-12" id="outside"><h2>Outside</h2>
	  <span class="metric"><span class="label">Temp:</span><span id="temperature_C"></span>&deg;C</span><br>
	  <span class="metric"><span class="label">Rel. Hum.</span><span id="humidity"></span>%</span><br>
	</div>
	<div class="col-lg-6 col-md-6 col-sm-12" id="wind">
	  <h2>Wind</h2>
	  <span class="metric"><span class="label">Direction:</span> <span id="direction_deg"></span>&deg;</span><br>
	  <span class="metric"><span class="label">Speed:</span> <span id="speed"></span>km/h</span><br>
	  <span class="metric"><span class="label">Gusting:</span> <span id="gust"></span>km/h</span><br>
	  <span class="metric"><span class="label">Rain:</span> <span id="rain"></span>mm</span><br>
	</div>
      </div>
      <div class="row h-25">
	<div class="col-lg-6 col-md-6 col-sm-12" id="tendency"></div>
	<div class="col-lg-6 col-md-6 col-sm-12" id="pressure"></div>
      </div>
      <div class="row h-25">
	<div clas="col-lg-12 col-md-12 col-sm-12" id="forecast">
	  <h2>5 Day Forecast</h2>
	</div>
      </div>
      <div class="row h-25">
	<div class="col-lg-6 col-md-6 col-sm-6" id="stats-tm">
	  <span class="metric"><span class="label">Date/Time:</span><span id="time"></span></span>
	</div>
	<div class="col-lg-6 col-md-6 col-sm-6" id="stats-bt">
	  <span class="metric"><span class="label">Battery:</span><span id="battery"></span></span>
	</div>
      </div>
    </div>
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script>
     
     const update = () => {
       $.getJSON("/wx.cgi?type=wx", struct => {
	 Object.keys(struct).forEach((k) => {
	   $(`#${k}`).html(struct[k]);
	 });
       });

       $.getJSON("/wx.cgi?type=forecast", struct => {
	 console.log(struct);

	 struct.DailyForecasts.forEach(day => {
	   const date = day.Date;
	   const min = `${day.Temperature.Minimum}˚${day.Temperature.Unit}`;
	   const max = `${day.Temperature.Maximum}˚${day.Temperature.Unit}`;
	   const summary = `${day.Day.ShortPhrase}`;
	   const icon = $(`<img src="gfx/${day.Day.Icon}.svg" alt="${day.Day.IconPhrase}"/>`);

	   const day = $(`<div>${date} Min:${min} Max:${max} ${summary}</div>`);
	   day.append(icon);
	   $('#forecast').append(day);
	 });
       });
     };

     const interval = setInterval(update, 30000);
     update();
     //{"time" : "2019-02-18 23:07:53", "model" : "Fine Offset Electronics WH1080/WH3080 Weather Station", "msg_type" : 0, "id" : 84, "temperature_C" : 4.100, "humidity" : 59, "direction_deg" : 225, "speed" : 1.224, "gust" : 3.672, "rain" : 804.600, "battery" : "LOW", "mic" : "CRC"}
    </script>
  </body>
</html>
